
options(warn = -1)
cr <- colorRampPalette(col=c("#C8524D", "#BDD791", "#447CBE", "#775A9C"), bias=1)
col <- cr(2)
scores <- list()

vmax <- 13361.000000
d <- as.numeric(c(13361.000000,4023.000000,11219.000000,6634.000000,13361.000000,12043.000000,7816.000000,7259.000000,13361.000000,13361.000000,10990.000000,13361.000000,13361.000000,9820.000000,12718.000000,13361.000000,13361.000000,13361.000000,6423.000000,13361.000000,13361.000000,13361.000000,13361.000000,13361.000000,6548.000000,2398.000000,6859.000000,13361.000000,13361.000000,12718.000000,13361.000000,13361.000000,13361.000000,1025.000000,13361.000000,11263.000000,13361.000000,13361.000000,11080.000000,13361.000000,13361.000000,13361.000000,13361.000000,13361.000000,12582.000000,11802.000000,7734.000000,9433.000000,8051.000000,13361.000000,12461.000000,6919.000000,3290.000000,6132.000000,13361.000000,9820.000000,2169.000000,13361.000000,3681.000000,13361.000000,13361.000000,13361.000000,3576.000000,913.000000,3867.000000,13361.000000,1303.000000,7640.000000,13361.000000,13361.000000,13361.000000,1880.000000,13361.000000,5633.000000,2398.000000,13361.000000,13361.000000,10990.000000,12115.000000,13361.000000,13361.000000,1336.000000,13361.000000,6811.000000,229.000000,13361.000000,13361.000000,13361.000000,6051.000000,13361.000000,13361.000000,13361.000000,7176.000000,13361.000000,5633.000000,13361.000000,9629.000000,10292.000000,2489.000000,3130.000000,7415.000000,13361.000000,761.000000,13361.000000,5074.000000,3469.000000,8225.000000,13361.000000,2292.000000,13361.000000,1340.000000,9892.000000,13361.000000,13361.000000,13361.000000,4982.000000,13361.000000,8883.000000,1861.000000,86.000000,13361.000000,3244.000000,13361.000000,13361.000000,7295.000000,13361.000000,2312.000000,13361.000000,13361.000000,13361.000000,6228.000000,3547.000000,2142.000000,13361.000000,5507.000000,13361.000000,13361.000000,11348.000000,13361.000000,12461.000000,13361.000000,11469.000000,87.000000,13361.000000,13361.000000,11520.000000,13361.000000,13361.000000,13361.000000,4843.000000,1235.000000,13361.000000,13361.000000))
bg <- d
bg[bg == 'NA'] <- NA
d <- as.numeric(c(13361,6178,9109,13361,13361,13361,11741,13361,3227,13361,1574,13361,13361,13361,347,10327,13361,13361,13361,13361,13361,7750,13361,13361,13361,81,13361,12582,13361,13361,11862,3143,8485,13361,13361,13361,13361,13361,6035,1152,13361,8206,8736,12461,13361,12582,8173,2873,13361,13361,4733,3547,13361,13361,8330,4707,12862,2895,13361,13361,13361,13361,6276,5848,13361,13361,13361,6051,2080,13361,11219,4720,4478,13361,12718,13361,13361,7384,13361,13361,13361,13361,13361,13361,4343,2126,13361,10841,13361,13361,13361,13361,2437,13361,13361,13361,13361,13361,13361,3200,13361,8330,13361,10893,13361,13361,4299,1907))
scores[["upregulate"]] <- d
d <- as.numeric(c(13361,6671,13361,13361,12043,3450,13361,13361,13361,13361,1971,13361,3492,13361,13361,13361,6830,13361,2622,13361,1420,9162,13361,2230,13361,736,5395,2720,3950,6389,13361,13361,826,1185,2086,13361,13361,10042,13361,13361,7155,13361,13361,13361,13361,105,13361,13361,13361,13361,13361,13361,13361,10548,13361,10261,1928,13361,10327,13361,6215,9629,2068,4600,2068,13361,13361,5262,5569,13361,10478,10445,5585,13361,13361,1222,12181,13361,569,6548,8238,13361,4777,11404,13361,13361,1042,6097,13361,13361,4015,8330,12364,13361,13361,13361,180,8523,13361,13361,3428,13361,13361,13361,13361,10129,13361,12718,1803,779,13361,7574,13361,12718,4478,202,7224,2593,1164,13361,10396,10042,10990,12115,13361,8361,12718,5250,13361,13361,13361,8681,4562,13361,4808,13361,13361,2769,13361,13361,7862,13361,13361,13361,13361,12043,3178,1683,13361,8472,10751,13361,11862,13361,9345,13361,6779,13361,13361,13361,7553,13361,6051,13361,7734,13361,13361,13361,2578,2578,13361,13361,13361,8991,10677,8296,13361,3178,9473,13361,13361,13361,13361,13361,13361,6423,13361,13361,13361,13361,89,13361,13361,13361,13361,13361,1060,1527,10129,13361,13361,10519,11862,13361,13361,13361,10396,13361,13361,10445,13361,9473,13361,13361,5160,13361,9025,13361,7774,1900,13361,7887,13361,13361,3547,13361,13361,3105,4849,13361,9597))
scores[["downregulate"]] <- d
uplimit <- trunc(vmax) + 1

breaks <- seq(0, uplimit, by = 1)
hs <- list()
d <- as.vector(na.omit(scores[["upregulate"]]))
d <- d[d >= 0 & d <= uplimit]
h <- hist(d, breaks = breaks, plot = FALSE)
hs[["upregulate"]] <- h
d <- as.vector(na.omit(scores[["downregulate"]]))
d <- d[d >= 0 & d <= uplimit]
h <- hist(d, breaks = breaks, plot = FALSE)
hs[["downregulate"]] <- h
dbg <- as.vector(na.omit(bg))
dbg <- dbg[dbg >= 0 & dbg <= uplimit]
hbg <- hist(dbg, breaks=breaks, plot=FALSE)

x <- h$mids
chs <- list()
c <- 100*cumsum(hs[["upregulate"]]$count)/sum(hs[["upregulate"]]$count)
chs[["upregulate"]] <- c
c <- 100*cumsum(hs[["downregulate"]]$count)/sum(hs[["downregulate"]]$count)
chs[["downregulate"]] <- c
cbg <- 100* cumsum(hbg$count)/sum(hbg$count)

p_values <- list()
d <- as.vector(na.omit(scores[["upregulate"]]))
d <- d[d >= 0 & d <= uplimit]
ks <- ks.test(d, dbg, alternative = "greater")
p_values[["upregulate"]] <- ks$p.value
d <- as.vector(na.omit(scores[["downregulate"]]))
d <- d[d >= 0 & d <= uplimit]
ks <- ks.test(d, dbg, alternative = "greater")
p_values[["downregulate"]] <- ks$p.value

ps = as.matrix(p_values)
write.table(ps, file = 'demo_pvalues.txt', sep = '	', col.names = F)
pdf("demo_function_prediction.pdf", height = 7, width = 7)
downlimit <- 81.000000
plot(x, cbg, type="l", lty=2, lwd=2, col="black", xlab="Rank of genes based on Regulatory Potential Score (from high to low)", ylab="Cumulative Fraction of Genes%", main="demo Activating/Repressive Function Prediction", xlim=c(downlimit, uplimit), ylim=c(0, 100))

l <- c('static (background)')
lines(x, chs[["upregulate"]], lty=1, lwd=2, col=col[1])
l <- c(l, paste("upregulate (", format(p_values[["upregulate"]], digits=3), ")", sep=""))
lines(x, chs[["downregulate"]], lty=1, lwd=2, col=col[2])
l <- c(l, paste("downregulate (", format(p_values[["downregulate"]], digits=3), ")", sep=""))
legend('topleft', legend=l, col=c('black',col), pch=15)
dev.off()